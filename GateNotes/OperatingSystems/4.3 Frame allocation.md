
#### 1 Frame Allocation
- **Overview**
	- The total number of frames is fixed
	- When page fault occurs
		- A empty frame is mapped to a page
		- Or when all frames are already mapped to a page, page replacement algorithm selects a page to swap out
- **How many frames to allocate to a process?**
	- **Minimize the number of frames allotted to a Process**
		- Allocate the minimum number of frames required by the process
		- The minimum number will depend on the computer architecture
	- **Problem with allocating only one frame to a process?**
		- The current instruction will be present in the frame
		- Let it be a load instruction with address that is not in main mem
		- This will lead to a page fault and the frame that is required for load is moved to main mem
		- But in order to restart the load instruction, the frame that contains the load instruction needs to be fetched again
		- In this case at least 2 frames are required
		- If indirect addressing is used, minimum of three frames are required
			- One frame for the current executing instruction 
			- Two frames for the memory reference (1 - direct addressing,  1 - indirect addressing)
- **Frame Allocation algorithms**
	- Split all the free frames equally between the processes
	- Split all the free frames proportionally based on the virtual memory size
		- i<sup>th</sup> process will be allocated a fraction of (s<sub>i</sub>/S)\*m , where 
			- s<sub>i</sub>: virt mem of i<sup>th</sup> process
			- S: sum of virt mem of all processes
			- m: # free frames

#### 2 Thrashing
- **What is it?**
	- A process is thrashing if most of the time is spent in paging rather than executing
- **What causes thrashing?**
	- Consider the following behavior of the OS
		- if the CPU utilization is less, OS increases the degree of multi programming
		- Global page replacement algorithm is used
			- When considering a frame for replacement, a replacement frame is selected from all the set of frames
	- When a process requires frames, it will replace the existing frames that are allocated
	- When number of process in ready queue decreases, the scheduler increases the degree of multi programming
	- This will cause more process to thrash
- **How to prevent thrashing?**
	- Can use local page replacement algorithm
		- Disadvantage: 
			- The MMU is responsible for paging, when there are many processes are thrashing, the access to increases for other processes that need to accessing the MMU 
	- Using locality of reference
		- **What is locality of reference?**
			- When a process access memory location X, it is more likely to access the memory locations near X
				- This means a process uses a set of pages (localities)
				- Each process can have multiple localities that may overlap
			- Caching works based on the locality of reference principle
				- If a process does random memory reference, then the pages that are already loaded will need to be swapped out often, making the cache useless
		- **How to use locality of reference to prevent thrashing?**
			- Allocate enough frames to process's current locality, this will prevent the process to thrash until the process changes to the next locality, this can be done by working set model
##### 2.1 Methods to prevent thrashing
- **Approach 1: Working set model**
	- This approach uses locality of reference
	- Working set: 
		- Set of most recent page references of a process of size delta
	- Delta needs to chosen appropriately for the process to not thrash
		- If delta is too small, the process will thrash
		- if delta is too big, the working set will have more number of frames than that is necessary for the process to execute
	- The current demand for the number of free frames will be the sum of sizes of the working set of all processes
	- If the current demand is greater than the number of free frames available, the OS terminates process and restarts it later when there are enough free frames
- **Approach 2: Using page fault frequency (PFF)**
	- **What is the correlation between PFF and \#frames allotted for a process?** 
		-  If the PFF is 
			- High: process does not have enough frames
			- Low: process has too many frames
	- **How to use PFF to prevent thrashing?**
		- Set a upper and lower bound for the PFF and allot frames accordingly

